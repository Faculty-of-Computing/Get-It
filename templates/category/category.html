{% extends "base.html" %}

{% block content %}
<div class="category-page container">
    <div class="filter-banner">
        <button id="toggle-filters-btn">
            <img src="{{ url_for('static', filename='searchicon.png') }}" alt="Filter"
                style="width: 24px; height: 24px;">
            <span>Filter & Sort</span>
        </button>
    </div>

    <!-- Filters Modal -->
    <aside class="category-filters">
        <div class="filter-header">
            <h3>Filter By</h3>
            <button id="close-filters-btn">&times;</button>
        </div>
        <form id="filterForm" method="get">
            <!-- The existing filter form content goes here -->
        </form>
    </aside>

    <!-- Products -->
    <section class="featured-section">
        {% if products %}
        <div class="products-grid">
            {% for product in products %}
            <div class="product-card" onclick="openModal('{{ loop.index0 }}')">
                <img src="{{ product.images[0] }}"
                    alt="{{ product.name }}" class="product-img">
                <h4>{{ product.name }}</h4>
                <p class="product-price">₦{{ '%.2f'|format(product.price) }}</p>
                <button class="btn" onclick="event.stopPropagation(); openModal('{{ loop.index0 }}')">View
                    Details</button>
            </div>
            {% endfor %}
        </div>
        <!-- Product Modals -->
        {% for product in products %}
        <div class="modal" id="modal-{{ loop.index0 }}">
            <div class="modal-content">
                <span class="close" onclick="closeModal('{{ loop.index0 }}')">&times;</span>
                <img src="{{ product.images[0]|default(url_for('static', filename='default_profile.svg')) }}"
                    alt="{{ product.name }}" class="modal-img">
                <h2>{{ product.name }}</h2>
                <p class="modal-price">₦{{ '%.2f'|format(product.price) }}</p>
                <p class="modal-desc">{{ product.description }}</p>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="no-products">
            <h3>No Products Found</h3>
            <p>There are currently no products available in this category or matching your filter criteria.</p>
            <a href="{{ url_for('home') }}" class="btn">Continue Shopping</a>
        </div>
        {% endif %}
    </section>
</div>
<script>
    function openModal(idx) {
        document.getElementById('modal-' + idx).style.display = 'block';
        document.body.style.overflow = 'hidden';
    }
    function closeModal(idx) {
        document.getElementById('modal-' + idx).style.display = 'none';
        document.body.style.overflow = '';
    }
    document.addEventListener('DOMContentLoaded', function () {
        const toggleBtn = document.getElementById('toggle-filters-btn');
        const closeBtn = document.getElementById('close-filters-btn');
        const filtersMenu = document.querySelector('.category-filters');
        const body = document.body;
        if (toggleBtn) {
            toggleBtn.addEventListener('click', function () {
                filtersMenu.classList.add('open');
                body.style.overflow = 'hidden';
            });
        }
        if (closeBtn) {
            closeBtn.addEventListener('click', function () {
                filtersMenu.classList.remove('open');
                body.style.overflow = '';
            });
        }
        // Close modals when clicking outside modal-content
        document.querySelectorAll('.modal').forEach(function (modal) {
            modal.addEventListener('click', function (e) {
                if (e.target === modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = '';
                }
            });
        });
    });
</script>


{% endblock %}